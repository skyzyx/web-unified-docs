---
page_title: tf-migrate stacks prepare reference
description: >-
  The `tf-migrate stacks prepare` command creates a plan to migrate your HCP Terraform workspace to a Stack.
# START AUTO GENERATED METADATA, DO NOT EDIT
created_at: 2025-11-06T08:59:10-05:00
last_modified: 2025-12-04T08:49:13-05:00
# END AUTO GENERATED METADATA
---

# `tf-migrate stacks prepare` reference

The `tf-migrate stacks prepare` generates new Terraform configuration to migrate one or more HCP Terraform workspaces to a Stack. 

@include "stacks.mdx"

## Usage

```
$ tf-migrate stacks prepare [options]
```

## Description

The `tf-migrate stacks prepare` command prompts you for the following information:

- A name for the Stack.
- A name for the new project to deploy the Stack to. This project must not already exist.

The `tf-migrate prepare` command copies your configuration and local modules to create a new Terraform Stack configuration in the `_stacks_generated` directory. It also generates Terraform configuration to perform the migration in the `stacks_migration_infra` directory.

This command does not change your existing configuration, state, or deployed resources.

The `tf-migrate stacks prepare` command creates one Stack `deployment` block for each HCP Terraform workspace the configuration manages. If your configuration's `cloud` block targets a single workspace with the `workspaces.name` argument, `tf-migrate` creates one Stack deployment. If your configuration's `cloud` block targets multiple workspaces with the `workspaces.tags` argument, `tf-migrate` creates a Stack deployment for each workspace that matches those tags.

The following is an example is a `terraform` block that defines two tags, one named `environment` and another named `application`.

```hcl
terraform {
  cloud {
    organization = "<ORG_NAME>"
    workspaces {
      tags = {
        "environment" = "development"
        "application" = "web"
      }
    }
  }
}
```

If this example matches two workspaces, `tf-migrate` creates two `deployment` blocks in the `_stacks_generated/deployment.tfdeploy.hcl` file and names them to match the workspace name. 

```hcl
deployment "web-dev-east" {
  inputs = {
    ##...
  }
  import = true
}



deployment "web-dev-west" {
  inputs = {
    ##...
  }
  import = true
}
```

## Example

The `tf-migrate stacks prepare` command generates the configuration to migrate this HCP Terraform workspace to a Stack. The following example creates a Stack named `my-new-stack` in the `my-project` project.

```
$ tf-migrate stacks prepare
âœ“ Environment readiness checks completed
âœ“ Extracted terraform configuration data from current directory
Enter the name of the stack to be created:  my-stack
Enter the name of a new project under which the stack will be created (project must not already exist):  my-stack-proj
âœ“ Fetched latest state file for workspace: my-workspace
âœ“ Parsed state file for workspace: my-workspace
âœ“ Extracted variables  from terraform configuration
âœ“ Extracted providers from terraform configuration
âœ“ Extracted outputs blocks from terraform configuration
âœ“ Created components from module blocks from terraform configuration
âœ“ Created deployments for workspaces provided
âœ“ Stack configuration files generated successfully
âœ“ Completed sanity check: terraform stacks init
âœ“ Completed sanity check: terraform stacks fmt
âœ“ Completed sanity check: terraform stacks validate

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ðŸŽ‰ The `tf-migrate stacks prepare` command completed successfully.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Next steps:
  1. Review the generated files before proceeding:
       a. _stacks_generated â€” contains Terraform Stacks configuration files.
       b. stacks_migration_infra â€” contains Terraform configuration files for creating stacks and migrating workspaces.

  2. Update all PLACEHOLDER values:
   - In output blocks (outputs.tfcomponent.hcl in _stacks_generated)
   - In deployment blocks (deployment.tfdeploy.hcl in _stacks_generated)

  3. Configure authentication if your stacks manage cloud resources
   (AWS, GCP, Azure, etc.):
   â†’ https://developer.hashicorp.com/terraform/language/stacks/deploy/authenticate

  4. Apply the configuration once all updates are complete:
     run: `tf-migrate stacks execute` to start the migration.
```

## Available options

You can include the following flags when you run the `tf-migrate prepare` command:

| Option | Description | Default | Required |
| ------ | ----------- | ------- | -------- |
| `-config-file` | Specifies the path to an optional configuration file. Refer to  [`tf-migrate` configuration file reference](/terraform/migrate/reference/configuration) for more information. | None | No |
| `-skip-workspaces` | Specifies a comma-separated list of workspaces to exclude from the migration. | None | No |