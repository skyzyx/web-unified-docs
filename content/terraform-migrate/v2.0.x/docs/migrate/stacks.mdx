---
page_title: Migrate workspaces to a Stack
description: >-
  Learn how to use `tf-migrate` to migrate one or more HCP Terraform workspaces to a Stack
# START AUTO GENERATED METADATA, DO NOT EDIT
created_at: 2025-11-06T08:59:10-05:00
last_modified: 2025-12-04T08:49:13-05:00
# END AUTO GENERATED METADATA
---

# Migrate workspaces to a Stack

You can use `tf-migrate` to migrate one or more HCP Terraform workspaces to a Stack. Refer to the [Stacks documentation](/terraform/cloud-docs/stacks) for more information on Stacks.

> **Hands-on:** Try the [Migrate a workspace to a Stack](/terraform/tutorials/cloud/stacks-migrate) tutorial.

@include 'stacks.mdx'

## Overview

Complete the following steps to migrate an HCP Terraform workspace to a Stack with `tf-migrate`:

1. If your Terraform configuration defines any resources in your root module, you must first convert your root module into a child module. If your root module only creates resources in child modules, you can skip this step. Refer to [Modularize configuration](#modularize-configuration) for more information on this process.
1. Run the `tf-migrate stacks prepare` command to generate your Terraform Stack configuration, prepare your state, and generate Terraform configuration to deploy the Stack. Refer to [Prepare Stack migration](#prepare-stack-migration) for more information.
1. Optionally, configure your cloud provider credentials. You can authenticate Stacks by using OIDC or by accessing existing authentication credentials in a variable set. Refer to the [Authenticate a Stack](/terraform/language/stacks/deploy/authenticate) documentation for more information.
1. Run the `tf-migrate stacks execute` command to perform the migration. Refer to [Execute Stack migration](#execute-stack-migration) for more information.
1. Optionally, remove the `import = true` argument from the `deployment` block to make changes to the deployed Stack. Refer to [Next steps](#next-steps) for more information.

## Requirements

The `tf-migrate` CLI requires the following to migrate an HCP Terraform workspace to a Stack:

- [tf-migrate 2.0+](/terraform/migrate/install) installed locally.
- [Terraform 1.13+](/terraform/install) installed locally.
- Terraform configuration deployed to one or more HCP Terraform workspaces.
- Terraform Stacks enabled in your HCP Terraform organization. Refer to [create a Stack](/terraform/cloud-docs/stacks/create#create-a-stack-1) for more information.

Optionally, if your configuration requires credentials to authenticate with a cloud provider, you must create an organization-wide variable set. Refer to the [Authenticate a Stack](/terraform/language/stacks/deploy/authenticate) documentation for more information.

## Modularize configuration

Convert your Terraform configuration into child modules by moving any resource configurations from the root module into children. You can use the `tf-migrate` CLI to create a converted copy of your existing configuration or convert the configuration manually. 

### Use the CLI to convert configuration

You can use the `tf-migrate modules create` command to copy your configuration, convert your root module into a child module, then save the converted configuration into a directory named `modularized_config`. The command does not modify your existing configuration or state.

```
$ tf-migrate modules create
âœ“ Found 1 terraform files in the root directory
âœ“ Extracted HCP Terraform data to identify the workspaces controlled by the configuration.

##...

Confirmation required ... ?

  Only 'yes' or 'no' will be accepted as input.
  Type 'yes' to approve proceed with the modularization process.
  Type 'no' to cancel and abort.

Enter a value:  yes

âœ“ Found 2 HCP Terraform workspaces associated with the configuration.
âœ“ Deleted backend block cloud from terraform block during modularization
âœ“ Successfully generated modularized configuration in modularized_config directory
âœ“ Modularization process completed successfully

Your modularized configuration files are available in the "modularized_config" directory.
```

Before you can migrate a converted configuration to a Stack, you must initialize the updated configuration. 

First, change to the new `modularized_config` directory:

```bash
$ cd modularized_config
```

Next, initialize the configuration:

```bash
$ terraform init
```

After initializing your configuration, prepare the Stack migration in the `modularized_config` directory.

Refer to the [`tf-migrate modules create` reference documentation](/terraform/migrate/reference/cli/modules/create) for more information.

### Manual conversion

You can instead convert the configuration manually rather than use the `tf-migrate modules create` command. The following example is a complete root module that has been modularized. It defines one provider and one output. All resources this configuration manages are defined in the `string` module:

<CodeBlockConfig fileName="main.tf" hideClipboard>

```hcl
terraform {
  required_providers {
    random = {
      source  = "hashicorp/random"
      version = "3.7.2"
    }
  }
  cloud {
    organization = "my-organization"
    workspaces {
      name = "my-workspace"
    }
  }
}

provider "random" {}

module "string" {
  source = "./modules/strings"
  length = 16
}

output "string" {
  value = module.string
}
```

</CodeBlockConfig>

## Prepare Stack migration

Use the `tf-migrate stacks prepare` command to generate configuration for a Stack, as well as Terraform configuration to deploy the Stack to HCP Terraform. This command does not modify your existing configuration or state.

```
$ tf-migrate stacks prepare
âœ“ Environment readiness checks completed
âœ“ Extracted terraform configuration data from current directory
Enter the name of the stack to be created:  my-stack
Enter the name of a new project under which the stack will be created (project must not already exist):  my-stack-proj
âœ“ Fetched latest state file for workspace: my-workspace
âœ“ Parsed state file for workspace: my-workspace
âœ“ Extracted variables  from terraform configuration
âœ“ Extracted providers from terraform configuration
âœ“ Extracted outputs blocks from terraform configuration
âœ“ Created components from module blocks from terraform configuration
âœ“ Created deployments for workspaces provided
âœ“ Stack configuration files generated successfully
âœ“ Completed sanity check: terraform stacks init
âœ“ Completed sanity check: terraform stacks fmt
âœ“ Completed sanity check: terraform stacks validate

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‰ The `tf-migrate stacks prepare` command completed successfully.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

The `tf-migrate stacks prepare` command creates the following directories:

- The `_stacks_generated` directory contains the generated Stack configuration. Refer to the [Define Stack configuration documentation](/terraform/language/stacks/component/config) for more information on this configuration.
- The `stacks_migration_infra` directory contains Terraform configuration to deploy the generated Stack configuration to HCP Terraform.

Refer to the [`tf-migrate stacks prepare` reference documentation](/terraform/migrate/reference/cli/stacks/prepare) for more information.

## Execute Stack migration

Use the `tf-migrate stacks execute` command to deploy the Stack configuration generated with the `tf-migrate stacks prepare` command.

```
$ tf-migrate stacks execute
âœ“ Stack configuration path found: /tmp/my-workspace/modularized_config/_stacks_generated
âœ“ Successfully validated stack configuration found in dir: /tmp/my-workspace/modularized_config/_stacks_generated
âœ“ Using dir: /tmp/my-workspace/modularized_config/stacks_migration_infra for terraform operations
âœ“ Init command ran successfully
âœ“ Plan command ran successfully and changes are detected
âœ“ Apply command ran successfully in 55.73248925s
Apply complete! Resources: 3 added, 0 changed, 0 destroyed.


Migration Summary
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Item    â”‚ URL                                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Project â”‚ https://app.terraform.io/app/<ORG>/projects/prj-a1b2c3d4e5f6g7h8                               â”‚
â”‚ Stack   â”‚ https://app.terraform.io/app/<ORG>/projects/prj-a1b2c3d4e5f6g7h8/stacks/st-a1b2c3d4e5f6g7h8    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Terraform Migrate has successfully executed the migration plan for your stack.
Please verify the migration in the HCP Terraform UI.
```

Refer to the [`tf-migrate stacks execute` reference documentation](/terraform/migrate/reference/cli/stacks/execute) for more information.

<!-- NOTE: The CLI references this anchor, do not change it -->
<a name="next-steps"></a>

## Next steps

After you complete the migration, you can modify your Stack configuration in the `_stacks_generated` directory. This directory contains your Stack components and configuration and you can move or rename this folder.

When `tf-migrate` generates your Stack configuration, it includes the `import = true` argument in the `deployment` block in the `deployment.tfdeploy.hcl` file. This argument tells HCP Terraform that it should not apply the configuration, and instead allows you to manually upload your Stack state.

If you want to make changes to your migrated Stack, you must remove the `import` flag or set its value to `false`.

<CodeBlockConfig filename="_stacks_generated/deployment.tfdeploy.hcl" hideClipboard>

```diff
deployment "my-workspace" {
  inputs = { }
-  import = true
}
```

</CodeBlockConfig>

You can use the following methods to deploy changes to your Stack:

- Run the `terraform stacks` CLI commands. For more information, refer to the [terraform stacks reference](/terraform/cli/commands/stacks) documentation.
- Use the HCP Terraform API. For more information, refer to the [Stacks API reference](/terraform/cloud-docs/api-docs/stacks) documentation.
- Commit your Stack configuration to source control and connect your stack to a VCS repository. For more information, refer to the [Configure a Stack](/terraform/cloud-docs/stacks/configure#configure-a-stack-1) documentation.