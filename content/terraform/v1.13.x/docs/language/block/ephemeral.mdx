---
page_title: Ephemeral block reference for the Terraform configuration language
description: Use the `ephemeral` block to define temporary resources that Terraform does not store in state or plan files.
# START AUTO GENERATED METADATA, DO NOT EDIT
created_at: 2025-09-05T15:51:39-04:00
last_modified: 2025-10-30T10:04:04-07:00
# END AUTO GENERATED METADATA
---

# `ephemeral` block reference

Use the `ephemeral` block to define temporary resources that Terraform does not store in state or plan files.

## Background

The `ephemeral` block declares a temporary ephemeral resource that only exists during the current Terraform operation. Terraform does not store ephemeral resources in state or plan files, making them ideal for managing sensitive or temporary data that you do not want to persist, such as temporary passwords or connections to other systems.

To learn more about the `ephemeral` block and its unique lifecycle and provisioning order, refer to [Manage sensitive data](/terraform/language/manage-sensitive-data).

### Lifecycle

Ephemeral resources have a unique lifecycle compared to regular resources and data sources. Terraform performs the following lifecycle steps for each ephemeral resource:
1. Terraform opens an ephemeral resource if it needs access to the resource’s result.
1. Terraform asks the ephemeral resource’s provider to periodically renew access if it needs to access the resource for longer than the remote system's enforced expiration time.
1. Terraform closes the ephemeral resource after the providers that depend on that resource complete their work for the current run phase.

As an example, if your Terraform configuration defines an ephemeral resource for a Vault secret, Terraform begins by opening the resource by having the Vault provider obtain a lease and return the secret. If needed, Terraform renews the resource by calling Vault's lease renewal API endpoint to extend the expiration time. Finally, Terraform closes the resource by explicitly ending the lease, letting Vault immediately revoke the associated credentials.


### Order of provisioning

Ephemeral resources form nodes in Terraform's dependency graph and interact similarly to resources and data sources. When a resource or data source depends on an attribute of an ephemeral resource, Terraform automatically provisions the ephemeral resource first.

If an input argument of an ephemeral resource references a value that Terraform does not know yet but can learn during or after a plan, Terraform defers executing that resource until the apply stage.


### Refer to ephemeral resources

You can only refer to ephemeral resources in specific ephemeral contexts. Otherwise, Terraform throws an error when it plans your changes. The following are valid contexts for referring to ephemeral resources:

- In a managed resource [write-only argument](/terraform/language/manage-sensitive-data/write-only)
- In another `ephemeral` block
- In the [`locals` block](/terraform/language/block/locals)
- In [`variable` blocks with the `ephemeral` argument set to `true`](/terraform/language/block/variable#ephemeral)
- In [child module `output` blocks with the `ephemeral` argument set to `true`](/terraform/language/block/output#ephemeral)
- Configuring [providers in the `provider` block](/terraform/language/functions/terraform-applying)
- In a provisioner and provisioner connection configuration. Refer to [Use a provisioner](/terraform/language/provisioners#use-a-provisioner) for more information.

## Configuration model

The `ephemeral` block supports the following arguments:

- [`ephemeral "<TYPE>" "<LABEL>"`](#ephemeral) &nbsp; block
  - [`<PROVIDER_ARGUMENTS>`](#provider-arguments) &nbsp; various | refer to your provider documentation
  - [`count`](#count) &nbsp; number | mutually exclusive with `for_each`
  - [`depends_on`](#depends_on) &nbsp; list of references
  - [`for_each`](#for_each) &nbsp; map or set of strings | mutually exclusive with `count`
  - [`provider`](#provider) &nbsp; reference
  - [`lifecycle`](#lifecycle) &nbsp; block
    - [`precondition`](#precondition) &nbsp; block
      - [`condition`](#precondition) &nbsp; expression
      - [`error_message`](#precondition) &nbsp; string
    - [`postcondition`](#postcondition) &nbsp; block
      - [`condition`](#postcondition) &nbsp; expression
      - [`error_message`](#postcondition) &nbsp; string

## Complete configuration

The following `ephemeral` block defines all of the supported built-in arguments you can set on an ephemeral resource:

<CodeBlockConfig hideClipboard>

```hcl
ephemeral "<TYPE>" "<LABEL>" {
  <PROVIDER_ARGUMENTS>
  count = <NUMBER>      # `for_each` and `count` are mutually exclusive
  depends_on = [ <RESOURCE.ADDRESS.EXPRESSION> ]
  for_each = {          # `for_each` accepts a map or a set of strings
    <KEY> = <VALUE>
  }
  for_each = [          # `for_each` accepts a map or a set of strings
    "<VALUE>",
    "<VALUE>"
  ]
  provider = <REFERENCE.TO.ALIAS>
  lifecycle {
    precondition {
      condition = <EXPRESSION>
      error_message = "<STRING>"
    }
    postcondition {
      condition = <EXPRESSION>
      error_message = "<STRING>"
    }
  }
}
```

</CodeBlockConfig>

## Specification

An `ephemeral` block supports the following configuration.

### `ephemeral "<TYPE>" "<LABEL>"`

You must set the following for every `ephemeral` block:

- `TYPE`: Specifies the type of ephemeral resource to create. Provider developers define the available ephemeral resource types. Refer to the provider documentation for details about specific ephemeral resource types.
- `LABEL`: Specifies a name for the ephemeral resource. Terraform uses this label to track the resource during the current operation. The label does not affect settings on the actual infrastructure resource. Refer to [References to Named Values](/terraform/language/expressions/references) and [Resource naming](/terraform/language/style#resource-naming) for label syntax and recommendations.

Refer to the ephemeral resource using `ephemeral.<TYPE>.<LABEL>` syntax.

### Provider-specific arguments

The provider developer determines which arguments you can define for an ephemeral resource. Refer to the provider documentation for details about available arguments and how to format their values.

#### Summary

- Data type: Various, depending on the provider
- Default: None, but requirements vary by provider
- Required: Varies by provider

### `count`

The `count` meta-argument instructs Terraform to provision multiple instances of the same ephemeral resource with identical or similar configuration. You cannot use both a `count` and ` for_each` argument in the same block.

<CodeBlockConfig hideClipboard>

```hcl
ephemeral "<TYPE>" "<LABEL>" {
  count = <number>
}
```

</CodeBlockConfig>

`count` is a **meta-argument**. Meta-arguments are built into the Terraform language and control how Terraform creates resources. Refer to the [`count` reference](/terraform/language/meta-arguments/count) for details about how the argument works.

### `depends_on`

The `depends_on` meta-argument specifies an upstream resource that the ephemeral resource depends on. When it creates a plan, Terraform sequences all operations on the upstream resource before performing operations on the ephemeral resource configured with the `depends_on` meta-argument.


```hcl
ephemeral "<TYPE>" "<LABEL>" {
  depends_on = [ <resource reference> ]
}
```

`depends_on` is a **meta-argument**. Meta-arguments are built into the Terraform language and control how Terraform creates resources. Refer to the [`depends_on` reference](/terraform/language/meta-arguments/depends_on) for details about how the argument works.

### `for_each`

The `for_each` meta-argument instructs Terraform to provision similar ephemeral resources without requiring separate configuration blocks for each resource.

<Tabs>

<Tab heading="List of values">

```hcl
ephemeral "<TYPE>" "<LABEL>" {
  for_each = [ "<VALUE>" ]
  # ...
}
```

</Tab>

<Tab heading="Map of key-value pairs">

```hcl
ephemeral "<TYPE>" "<LABEL>" {
  for_each = {
    "<KEY>" = "<VALUE>"
  }
}
```

</Tab>

</Tabs>

`for_each` is a **meta-argument**. Meta-arguments are built into the Terraform language and control how Terraform creates resources. Refer to the [`for_each` reference](/terraform/language/meta-arguments/for_each) for details about how the argument works.

### `provider`

The `provider` argument instructs Terraform to use an alternate provider configuration to provision the ephemeral resource.

<CodeBlockConfig hideClipboard>

```hcl
ephemeral "<TYPE>" "<LABEL>" {
  provider = <PROVIDER>.<ALIAS>
}
```

</CodeBlockConfig>

`provider` is a **meta-argument**. Meta-arguments are built into the Terraform language and control how Terraform creates resources. Refer to the [`provider` reference](/terraform/language/meta-arguments/provider) for details about how the argument works.

### `lifecycle`

The `lifecycle` block defines lifecycle rules for how Terraform operates on your ephemeral resource.

<CodeBlockConfig hideClipboard>

```hcl
ephemeral "<TYPE>" "<LABEL>" {
  lifecycle {
    <lifecycle>
  }
}
```

</CodeBlockConfig>

You can specify the following lifecycle rules to manage how Terraform performs operations on the ephemeral resource:

- [`precondition`](#precondition): Specifies a condition that Terraform evaluates before creating the ephemeral resource. Refer to [Test and validate](/terraform/language/validate#preconditions) for more information.
- [`postcondition`](#postcondition): Specifies a condition that Terraform evaluates after creating the ephemeral resource. Refer to [Test and validate](/terraform/language/validate#postconditions) for more information.

You can include both `precondition` and `postcondition` blocks in the same `lifecycle` block, and you can define multiple `precondition` and `postcondition` blocks in the same `lifecycle` block.

`lifecycle` is a **meta-argument**. Meta-arguments are built into the Terraform language and control how Terraform creates resources. Refer to the [`lifecycle` reference](/terraform/language/meta-arguments/lifecycle) for details about how the argument works.

### `precondition`

The `precondition` block specifies a condition that must return `true` before Terraform evaluates and performs operations on the ephemeral resource. You can also specify an error message for Terraform to print when the condition returns `false`.

```hcl
ephemeral "<TYPE>" "<LABEL>" {
  lifecycle {
    precondition {
      condition           = <expression>
      error_message       = "<message>"
    }
  }
}
```

`precondition` is a directive available in the `lifecycle` **meta-argument**. Meta-arguments are built into the Terraform language and control how Terraform creates resources. Refer to the [`lifecycle` reference](/terraform/language/meta-arguments/lifecycle) for details about how the argument works.

### `postcondition`

The `postcondition` block specifies a condition that must return `true` after Terraform performs operations on the ephemeral resource. You can also specify an error message for Terraform to print to the console when the condition returns `false`.

```hcl
ephemeral "<TYPE>" "<LABEL>" {
  lifecycle {
    postcondition {
      condition = <expression>
      error_message = "<message>"
    }
  }
}
```

`postcondition` is a directive available in the `lifecycle` **meta-argument**. Meta-arguments are built into the Terraform language and control how Terraform creates resources. Refer to the [`lifecycle` reference](/terraform/language/meta-arguments/lifecycle) for details about how the argument works.

## Examples

The following examples demonstrate common use cases for `ephemeral` blocks.

### Fundamental ephemeral resource

In the following example, the `aws_secretsmanager_secret_version` ephemeral resource provides credentials to configure the PostgreSQL provider:

<CodeBlockConfig highlight="1-3, 6">

```hcl
ephemeral "aws_secretsmanager_secret_version" "db_master" {
  secret_id = aws_secretsmanager_secret_version.db_password.secret_id
}

locals {
  credentials = jsondecode(ephemeral.aws_secretsmanager_secret_version.db_master.secret_string)
}

provider "postgresql" {
  host     = aws_db_instance.example.address
  port     = aws_db_instance.example.port
  username = local.credentials["username"]
  password = local.credentials["password"]
# …
}
```

</CodeBlockConfig>

An ephemeral resource handles the credentials so Terraform never stores them in state or plan files. If you reference an `ephemeral` resource in `locals` block that value in the `locals` block is also not stored in state or plan files because Terraform intuitively understands you do not want that value stored.

### Use ephemeral values with a write-only argument

Write-only arguments let you securely pass temporary values to managed resources during an operation without persisting those resource values to state or plan files. In the following example, the `random_password` ephemeral resource generates a temporary password and passes it to the `password_wo` write-only argument:

<CodeBlockConfig highlight="3,16">

```hcl
#...

ephemeral "random_password" "db_password" {
  length           = 16
  override_special = "!#$%&*()-_=+[]{}<>:?"
}

resource "aws_db_instance" "example" {
  instance_class       = "db.t3.micro"
  allocated_storage    = "5"
  engine               = "postgres"
  username             = "example"
  skip_final_snapshot  = true
  publicly_accessible  = true
  db_subnet_group_name = aws_db_subnet_group.example.name
  password_wo          = ephemeral.random_password.db_password.result
  password_wo_version  = 1
}
```

</CodeBlockConfig>

Neither write-only arguments nor `ephemeral` resources are persisted outside of the current Terraform run, ensuring that the `ephemeral.random_password.db_password.result` value is completely omitted from state and plan files.

Terraform does not store the generated value of `ephemeral.random_password.db_password.result`, but you can capture it in another resource to ensure the value is not lost. For an example of generating, storing, retrieving, and using an ephemeral password, refer to [write-only arguments](/terraform/language/manage-sensitive-data/write-only#set-and-store-an-ephemeral-password-in-aws-secrets-manager).