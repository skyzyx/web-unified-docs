#!/bin/sh

# Check for .env files (including .env.local, .env.development, etc.)
ENV_FILES=$(git diff --cached --name-only | grep '\.env' || true)

if [ -n "$ENV_FILES" ]; then
    echo "ERROR: .env files detected in staged changes!"
    echo ""
    echo "The following .env files are staged for commit:"
    echo "$ENV_FILES" | awk '{print "  - " $0}'
    echo ""
    echo ".env files should not be committed as they may contain sensitive information."
    echo "Please unstage these files using: git reset HEAD <file>"
    echo ""
    exit 1
fi

echo "No .env files detected in commit"

# Add date metadata to changed markdown files
MDX_FILES=$(git diff --cached --name-only | grep '^content/.*\.mdx$' || true)
if [ -n "$MDX_FILES" ]; then
    echo "Adding date metadata to changed .mdx files..."
    echo "$MDX_FILES" | while read -r FILE; do
        node ./scripts/add-date-metadata.mjs "$FILE" "$(date -Iseconds)"
        git add "$FILE"
    done
fi

# Run lint-staged
npx lint-staged
